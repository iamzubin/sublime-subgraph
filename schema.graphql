type CreditLine @entity {
  #creditLine number
  id: ID!
  # credit line line variables
  creditLineVar: CreditLineVariable
  # credit line constants
  creditLineConstant: CreditLineConstant
}

type CreditLineGlobalParam @entity {
  # use always 1, to store the global params
  id: ID!
  # strategy registry
  strategyRegistry: String
  # savings account
  savingsAccount: String
  # protocol fee fraction
  protocolFeeFraction: BigInt
  # protocol fee collector
  protocolFeeCollector: String
  # price oracle
  priceOracle: String
  # liquidation reward fraction
  liquidationRewardFraction: BigInt
  # default strategy
  defaultStrategy: String
}

type CreditLineConstant @entity {
  id: ID!
  lender: String
  borrower: String
  borrowLimit: BigInt
  idealCollateralRatio: BigInt
  borrowRate: BigInt
  borrowAsset: String
  collateralAsset: String
  autoLiquidation: Boolean
  requestByLender: Boolean
}

type CreditLineVariable @entity {
  id: ID!
  status: CreditLineStatus
  principal: BigInt
  totalInterestRepaid: BigInt
  lastPrincipalUpdateTime: BigInt
  interestAccruedTillLastPrincipalUpdate: BigInt
  collateralAmount: BigInt
}

enum CreditLineStatus {
  NOT_CREATED
  REQUESTED
  ACTIVE
  CLOSED
  CANCELLED
  LIQUIDATED
}

type StrategyRegistry @entity {
  id: ID!
  max: BigInt!
  strategyOrder: [Strategy!]
}

type Strategy @entity {
  id: ID!
  address: String!
  enabled: Boolean!
}

type SavingsAccount @entity {
  id: ID!
  address: String!
  deposits: [Deposit]!
  allowances: [Allowance]!
}

type Deposit @entity {
  id: ID!
  token: String!
  strategyDeposits: [DepositPerStrategy]!
}

type DepositPerStrategy @entity {
  id: ID!
  strategy: String!
  token: String!
  shares: BigInt!
}

type Allowance @entity {
  id: ID!
  token: String!
  to: [AllowancePerAddress]!
}

type AllowancePerAddress @entity {
  id: ID!
  to: String!
  token: String!
  amount: BigInt!
}